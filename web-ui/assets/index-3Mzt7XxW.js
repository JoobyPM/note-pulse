(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function o(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(i){if(i.ep)return;i.ep=!0;const l=o(i);fetch(i.href,l)}})();const Y=new Set,n={accessToken:null,refreshToken:null,notesById:new Map,noteOrder:[],currentNoteId:null,isLoading:!1,nextCursor:null,prevCursor:null,limit:30,q:"",sort:"created_at",order:"desc",totalCount:null,ws:null,reconnectTimerId:null,backoffDelay:0,refreshingPromise:null,refreshFailures:0,refreshBlockedUntil:0,lastFailure:0,accessExp:0,ACCESS_THRESHOLD_SEC:300},p=t=>{Object.assign(n,t),Y.forEach(e=>e(n))},me=t=>(Y.add(t),()=>Y.delete(t)),$=t=>{n.notesById.has(t.id)||n.noteOrder.unshift(t.id),n.notesById.set(t.id,t),p({notesById:n.notesById,noteOrder:n.noteOrder})},ye=t=>{const e=n.noteOrder.indexOf(t);e>-1&&(n.noteOrder.splice(e,1),n.notesById.delete(t),p({notesById:n.notesById,noteOrder:n.noteOrder,currentNoteId:n.currentNoteId===t?null:n.currentNoteId}))},J=()=>{n.noteOrder.length=0,n.notesById.clear(),p({notesById:n.notesById,noteOrder:n.noteOrder,nextCursor:null,prevCursor:null})},Le=()=>{n.noteOrder.length=0,n.notesById.clear(),p({notesById:n.notesById,noteOrder:n.noteOrder,currentNoteId:null,nextCursor:null,prevCursor:null,limit:30,q:"",sort:"created_at",order:"desc",totalCount:null})},G=window.location.origin,be=G+"/api/v1",Oe=(G.startsWith("https")?"wss://":"ws://")+G.replace(/^https?:\/\//,"")+"/ws/notes/stream",Ie=t=>{try{const e=t.replace(/-/g,"+").replace(/_/g,"/"),o=e.padEnd(e.length+(4-e.length%4)%4,"=");return atob(o)}catch{return console.warn("Token decoding failed - invalid token format"),null}},ve=t=>{try{const e=Ie(t.split(".")[1]);return e?JSON.parse(e).exp*1e3:0}catch{return console.warn("Token parsing failed"),0}},de=(t,e,o)=>{try{t.setItem(e,o)}catch(r){console.warn(`Failed to set ${e} in storage:`,r)}},ue=(t,e)=>{try{t.removeItem(e)}catch(o){console.warn(`Failed to remove ${e} from storage:`,o)}},Me=()=>{const t=sessionStorage.getItem("notePulseAccess")||null,e=localStorage.getItem("notePulseRefresh")||null,o=t?ve(t):0;let r=300;if(t&&o>0){const i=Math.max(0,(o-Date.now())/1e3);r=Math.max(30,Math.floor(i*.5))}p({accessToken:t,refreshToken:e,accessExp:o,ACCESS_THRESHOLD_SEC:r})},Pe=(t,e)=>{const o=ve(t);de(sessionStorage,"notePulseAccess",t);const r=Math.max(0,(o-Date.now())/1e3),l=Math.max(30,Math.floor(r*.5)),d={accessToken:t,accessExp:o,ACCESS_THRESHOLD_SEC:l};e&&(d.refreshToken=e,de(localStorage,"notePulseRefresh",e)),p(d)},Ae=()=>{ue(sessionStorage,"notePulseAccess"),ue(localStorage,"notePulseRefresh"),p({accessToken:null,refreshToken:null,accessExp:0})},oe=async()=>{n.accessToken&&(Date.now()+n.ACCESS_THRESHOLD_SEC*1e3<n.accessExp||await re())},re=()=>{if(Date.now()<n.refreshBlockedUntil)throw new Error("refresh back-off");if(n.refreshingPromise)return n.refreshingPromise;if(!n.refreshToken)throw new Error("no refresh token");const t=(async()=>{const e=new AbortController,o=setTimeout(()=>e.abort(),1e4);try{const r=await fetch(be+"/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:n.refreshToken}),signal:e.signal});if(r.status===401)throw U(),location.hash="#/sign-in",new Error("refresh token expired");if(!r.ok)throw new Error("refresh failed");const i=await r.json();Pe(i.token,i.refresh_token),p({refreshFailures:0,refreshBlockedUntil:0,refreshingPromise:null})}finally{clearTimeout(o),p({refreshingPromise:null})}})().catch(e=>{if(e.message==="refresh token expired")throw e;const o=Date.now();o-n.lastFailure>3e5&&p({refreshFailures:0});const r=n.refreshFailures+1,i=Math.min(1e3*2**(r-1),3e4);throw p({refreshFailures:r,lastFailure:o,refreshBlockedUntil:Date.now()+i}),e});return p({refreshingPromise:t}),t},S=async(t,e={},o=!1)=>{await oe().catch(()=>{});const r=new AbortController,i={headers:{"Content-Type":"application/json",...e.headers||{}},...e};n.accessToken&&(i.headers.Authorization="Bearer "+n.accessToken),i.signal=r.signal;const l=await fetch(be+t,i);if(l.status===401&&!o)try{return await re(),i.headers.Authorization="Bearer "+n.accessToken,S(t,i,!0)}catch{throw U(),location.hash="#/sign-in",new Error("Session expired")}if(!l.ok){let d="Error "+l.status;try{const g=await l.json();g.error&&(d=g.error)}catch{console.error("Error parsing JSON response:",l)}throw new Error(d)}return l.status===204?null:l.json()},He=30,L={signUp:(t,e)=>S("/auth/sign-up",{method:"POST",body:JSON.stringify({email:t,password:e})}),signIn:(t,e)=>S("/auth/sign-in",{method:"POST",body:JSON.stringify({email:t,password:e})}),signOut:()=>S("/auth/sign-out",{method:"POST",body:JSON.stringify({refresh_token:n.refreshToken})}),listNotes:(t,e=He)=>{if(typeof t=="object"&&t!==null){const o=t,r=[];o.limit!==void 0&&o.limit>=1&&o.limit<=100&&r.push(`limit=${o.limit}`),o.cursor&&r.push(`cursor=${o.cursor}`),o.q&&o.q.length>=1&&o.q.length<=256&&r.push(`q=${encodeURIComponent(o.q)}`),o.sort&&["created_at","updated_at","title"].includes(o.sort)&&r.push(`sort=${o.sort}`),o.order&&["asc","desc"].includes(o.order)&&r.push(`order=${o.order}`);const i=r.length>0?"?"+r.join("&"):"";return S("/notes"+i)}else{const o=t;return S("/notes"+(o?`?cursor=${o}&limit=${e}`:`?limit=${e}`))}},createNote:t=>S("/notes",{method:"POST",body:JSON.stringify(t)}),updateNote:(t,e)=>S(`/notes/${t}`,{method:"PATCH",body:JSON.stringify(e)}),deleteNote:t=>S(`/notes/${t}`,{method:"DELETE"}),me:()=>S("/me")},q=async t=>{if(n.ws&&(n.ws.readyState===WebSocket.OPEN||n.ws.readyState===WebSocket.CONNECTING))return;if(Date.now()<n.refreshBlockedUntil){setTimeout(()=>q(t),n.refreshBlockedUntil-Date.now()+100);return}if(await oe().catch(()=>{}),!n.accessToken)return;n.ws&&(n.ws.onclose=null,n.ws.onmessage=null,n.ws.onerror=null,n.ws.close());const e=new WebSocket(`${Oe}?token=${n.accessToken}`);n.reconnectTimerId&&(clearTimeout(n.reconnectTimerId),p({reconnectTimerId:null,backoffDelay:0})),e.onopen=()=>{p({ws:e})},e.onmessage=t,e.onerror=()=>fe(()=>q(t)),e.onclose=async o=>{if(p({ws:null}),[1008,1006,4001].includes(o.code)){try{await re()}catch{}setTimeout(()=>q(t),500)}else fe(()=>q(t))},p({ws:e})},fe=t=>{const e=n.backoffDelay?Math.min(n.backoffDelay*2,3e4):1e3,o=e*.1*(2*Math.random()-1),r=Math.max(100,e+o),i=setTimeout(t,r);p({backoffDelay:e,reconnectTimerId:i})},_e=()=>{n.reconnectTimerId&&clearTimeout(n.reconnectTimerId),n.ws&&(n.ws.onclose=null,n.ws.onmessage=null,n.ws.onerror=null,n.ws.close()),p({ws:null,reconnectTimerId:null,backoffDelay:0})},U=()=>{Ae(),_e()};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var C=function(){return C=Object.assign||function(e){for(var o,r=1,i=arguments.length;r<i;r++){o=arguments[r];for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(e[l]=o[l])}return e},C.apply(this,arguments)},De=function(){function t(e){this.options=e,this.listeners={}}return t.prototype.on=function(e,o){var r=this.listeners[e]||[];this.listeners[e]=r.concat([o])},t.prototype.triggerEvent=function(e,o){var r=this,i=this.listeners[e]||[];i.forEach(function(l){return l({target:r,event:o})})},t}(),A;(function(t){t[t.Add=0]="Add",t[t.Remove=1]="Remove"})(A||(A={}));var Be=function(){function t(){this.notifications=[]}return t.prototype.push=function(e){this.notifications.push(e),this.updateFn(e,A.Add,this.notifications)},t.prototype.splice=function(e,o){var r=this.notifications.splice(e,o)[0];return this.updateFn(r,A.Remove,this.notifications),r},t.prototype.indexOf=function(e){return this.notifications.indexOf(e)},t.prototype.onUpdate=function(e){this.updateFn=e},t}(),M;(function(t){t.Dismiss="dismiss",t.Click="click"})(M||(M={}));var he={types:[{type:"success",className:"notyf__toast--success",backgroundColor:"#3dc763",icon:{className:"notyf__icon--success",tagName:"i"}},{type:"error",className:"notyf__toast--error",backgroundColor:"#ed3d3d",icon:{className:"notyf__icon--error",tagName:"i"}}],duration:2e3,ripple:!0,position:{x:"right",y:"bottom"},dismissible:!1},qe=function(){function t(){this.notifications=[],this.events={},this.X_POSITION_FLEX_MAP={left:"flex-start",center:"center",right:"flex-end"},this.Y_POSITION_FLEX_MAP={top:"flex-start",center:"center",bottom:"flex-end"};var e=document.createDocumentFragment(),o=this._createHTMLElement({tagName:"div",className:"notyf"});e.appendChild(o),document.body.appendChild(e),this.container=o,this.animationEndEventName=this._getAnimationEndEventName(),this._createA11yContainer()}return t.prototype.on=function(e,o){var r;this.events=C(C({},this.events),(r={},r[e]=o,r))},t.prototype.update=function(e,o){o===A.Add?this.addNotification(e):o===A.Remove&&this.removeNotification(e)},t.prototype.removeNotification=function(e){var o=this,r=this._popRenderedNotification(e),i;if(r){i=r.node,i.classList.add("notyf__toast--disappear");var l;i.addEventListener(this.animationEndEventName,l=function(d){d.target===i&&(i.removeEventListener(o.animationEndEventName,l),o.container.removeChild(i))})}},t.prototype.addNotification=function(e){var o=this._renderNotification(e);this.notifications.push({notification:e,node:o}),this._announce(e.options.message||"Notification")},t.prototype._renderNotification=function(e){var o,r=this._buildNotificationCard(e),i=e.options.className;return i&&(o=r.classList).add.apply(o,i.split(" ")),this.container.appendChild(r),r},t.prototype._popRenderedNotification=function(e){for(var o=-1,r=0;r<this.notifications.length&&o<0;r++)this.notifications[r].notification===e&&(o=r);if(o!==-1)return this.notifications.splice(o,1)[0]},t.prototype.getXPosition=function(e){var o;return((o=e==null?void 0:e.position)===null||o===void 0?void 0:o.x)||"right"},t.prototype.getYPosition=function(e){var o;return((o=e==null?void 0:e.position)===null||o===void 0?void 0:o.y)||"bottom"},t.prototype.adjustContainerAlignment=function(e){var o=this.X_POSITION_FLEX_MAP[this.getXPosition(e)],r=this.Y_POSITION_FLEX_MAP[this.getYPosition(e)],i=this.container.style;i.setProperty("justify-content",r),i.setProperty("align-items",o)},t.prototype._buildNotificationCard=function(e){var o=this,r=e.options,i=r.icon;this.adjustContainerAlignment(r);var l=this._createHTMLElement({tagName:"div",className:"notyf__toast"}),d=this._createHTMLElement({tagName:"div",className:"notyf__ripple"}),g=this._createHTMLElement({tagName:"div",className:"notyf__wrapper"}),a=this._createHTMLElement({tagName:"div",className:"notyf__message"});a.innerHTML=r.message||"";var s=r.background||r.backgroundColor;if(i){var c=this._createHTMLElement({tagName:"div",className:"notyf__icon"});if((typeof i=="string"||i instanceof String)&&(c.innerHTML=new String(i).valueOf()),typeof i=="object"){var u=i.tagName,f=u===void 0?"i":u,h=i.className,v=i.text,y=i.color,m=y===void 0?s:y,_=this._createHTMLElement({tagName:f,className:h,text:v});m&&(_.style.color=m),c.appendChild(_)}g.appendChild(c)}if(g.appendChild(a),l.appendChild(g),s&&(r.ripple?(d.style.background=s,l.appendChild(d)):l.style.background=s),r.dismissible){var R=this._createHTMLElement({tagName:"div",className:"notyf__dismiss"}),P=this._createHTMLElement({tagName:"button",className:"notyf__dismiss-btn"});R.appendChild(P),g.appendChild(R),l.classList.add("notyf__toast--dismissible"),P.addEventListener("click",function(O){var I,T;(T=(I=o.events)[M.Dismiss])===null||T===void 0||T.call(I,{target:e,event:O}),O.stopPropagation()})}l.addEventListener("click",function(O){var I,T;return(T=(I=o.events)[M.Click])===null||T===void 0?void 0:T.call(I,{target:e,event:O})});var j=this.getYPosition(r)==="top"?"upper":"lower";return l.classList.add("notyf__toast--"+j),l},t.prototype._createHTMLElement=function(e){var o=e.tagName,r=e.className,i=e.text,l=document.createElement(o);return r&&(l.className=r),l.textContent=i||null,l},t.prototype._createA11yContainer=function(){var e=this._createHTMLElement({tagName:"div",className:"notyf-announcer"});e.setAttribute("aria-atomic","true"),e.setAttribute("aria-live","polite"),e.style.border="0",e.style.clip="rect(0 0 0 0)",e.style.height="1px",e.style.margin="-1px",e.style.overflow="hidden",e.style.padding="0",e.style.position="absolute",e.style.width="1px",e.style.outline="0",document.body.appendChild(e),this.a11yContainer=e},t.prototype._announce=function(e){var o=this;this.a11yContainer.textContent="",setTimeout(function(){o.a11yContainer.textContent=e},100)},t.prototype._getAnimationEndEventName=function(){var e=document.createElement("_fake"),o={MozTransition:"animationend",OTransition:"oAnimationEnd",WebkitTransition:"webkitAnimationEnd",transition:"animationend"},r;for(r in o)if(e.style[r]!==void 0)return o[r];return"animationend"},t}(),$e=function(){function t(e){var o=this;this.dismiss=this._removeNotification,this.notifications=new Be,this.view=new qe;var r=this.registerTypes(e);this.options=C(C({},he),e),this.options.types=r,this.notifications.onUpdate(function(i,l){return o.view.update(i,l)}),this.view.on(M.Dismiss,function(i){var l=i.target,d=i.event;o._removeNotification(l),l.triggerEvent(M.Dismiss,d)}),this.view.on(M.Click,function(i){var l=i.target,d=i.event;return l.triggerEvent(M.Click,d)})}return t.prototype.error=function(e){var o=this.normalizeOptions("error",e);return this.open(o)},t.prototype.success=function(e){var o=this.normalizeOptions("success",e);return this.open(o)},t.prototype.open=function(e){var o=this.options.types.find(function(l){var d=l.type;return d===e.type})||{},r=C(C({},o),e);this.assignProps(["ripple","position","dismissible"],r);var i=new De(r);return this._pushNotification(i),i},t.prototype.dismissAll=function(){for(;this.notifications.splice(0,1););},t.prototype.assignProps=function(e,o){var r=this;e.forEach(function(i){o[i]=o[i]==null?r.options[i]:o[i]})},t.prototype._pushNotification=function(e){var o=this;this.notifications.push(e);var r=e.options.duration!==void 0?e.options.duration:this.options.duration;r&&setTimeout(function(){return o._removeNotification(e)},r)},t.prototype._removeNotification=function(e){var o=this.notifications.indexOf(e);o!==-1&&this.notifications.splice(o,1)},t.prototype.normalizeOptions=function(e,o){var r={type:e};return typeof o=="string"?r.message=o:typeof o=="object"&&(r=C(C({},r),o)),r},t.prototype.registerTypes=function(e){var o=(e&&e.types||[]).slice(),r=he.types.map(function(i){var l=-1;o.forEach(function(g,a){g.type===i.type&&(l=a)});var d=l!==-1?o.splice(l,1)[0]:{};return C(C({},i),d)});return r.concat(o)},t}();const we=/^#[0-9a-f]{6}$/i,K=/^#[0-9a-f]{3}$/i,Z=t=>we.test(t)||K.test(t),Q=t=>{if(!t)return t;if(we.test(t))return t.slice(0,7);if(K.test(t)){const[,e,o,r]=t.match(K);return`#${e}${e}${o}${o}${r}${r}`}return t},b=(t,e=document)=>e.querySelector(t),Fe=(t,e="")=>{const o=document.createElement(t);return e&&(o.className=e),o};function W(t,e=200){let o;const r=function(...i){o!==void 0&&clearTimeout(o),o=setTimeout(()=>t.apply(this,i),e)};return r.cancel=()=>{o!==void 0&&clearTimeout(o),o=void 0},r}function Re(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ke={exports:{}};(function(t){(function(e,o){t.exports=o()})("Clusterize",function(){var e=function(){for(var a=3,s=document.createElement("b"),c=s.all||[];s.innerHTML="<!--[if gt IE "+ ++a+"]><i><![endif]-->",c[0];);return a>4?a:document.documentMode}(),o=navigator.platform.toLowerCase().indexOf("mac")+1,r=function(a){if(!(this instanceof r))return new r(a);var s=this,c={rows_in_block:50,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,callbacks:{}};s.options={};for(var u=["rows_in_block","blocks_in_cluster","show_no_data_row","no_data_class","no_data_text","keep_parity","tag","callbacks"],f=0,h;h=u[f];f++)s.options[h]=typeof a[h]<"u"&&a[h]!=null?a[h]:c[h];for(var v=["scroll","content"],f=0,y;y=v[f];f++)if(s[y+"_elem"]=a[y+"Id"]?document.getElementById(a[y+"Id"]):a[y+"Elem"],!s[y+"_elem"])throw new Error("Error! Could not find "+y+" element");s.content_elem.hasAttribute("tabindex")||s.content_elem.setAttribute("tabindex",0);var m=d(a.rows)?a.rows:s.fetchMarkup(),_={},R=s.scroll_elem.scrollTop;s.insertToDOM(m,_),s.scroll_elem.scrollTop=R;var P=!1,j=0,O=!1,I=function(){o&&(O||(s.content_elem.style.pointerEvents="none"),O=!0,clearTimeout(j),j=setTimeout(function(){s.content_elem.style.pointerEvents="auto",O=!1},50)),P!=(P=s.getClusterNum(m))&&s.insertToDOM(m,_),s.options.callbacks.scrollingProgress&&s.options.callbacks.scrollingProgress(s.getScrollProgress())},T=0,le=function(){clearTimeout(T),T=setTimeout(s.refresh,100)};i("scroll",s.scroll_elem,I),i("resize",window,le),s.destroy=function(E){l("scroll",s.scroll_elem,I),l("resize",window,le),s.html((E?s.generateEmptyRow():m).join(""))},s.refresh=function(E){(s.getRowsHeight(m)||E)&&s.update(m)},s.update=function(E){m=d(E)?E:[];var D=s.scroll_elem.scrollTop;m.length*s.options.item_height<D&&(s.scroll_elem.scrollTop=0,P=0),s.insertToDOM(m,_),s.scroll_elem.scrollTop=D},s.clear=function(){s.update([])},s.getRowsAmount=function(){return m.length},s.getScrollProgress=function(){return this.options.scroll_top/(m.length*this.options.item_height)*100||0};var ce=function(E,D){var X=d(D)?D:[];X.length&&(m=E=="append"?m.concat(X):X.concat(m),s.insertToDOM(m,_))};s.append=function(E){ce("append",E)},s.prepend=function(E){ce("prepend",E)}};r.prototype={constructor:r,fetchMarkup:function(){for(var a=[],s=this.getChildNodes(this.content_elem);s.length;)a.push(s.shift().outerHTML);return a},exploreEnvironment:function(a,s){var c=this.options;c.content_tag=this.content_elem.tagName.toLowerCase(),a.length&&(e&&e<=9&&!c.tag&&(c.tag=a[0].match(/<([^>\s/]*)/)[1].toLowerCase()),this.content_elem.children.length<=1&&(s.data=this.html(a[0]+a[0]+a[0])),c.tag||(c.tag=this.content_elem.children[0].tagName.toLowerCase()),this.getRowsHeight(a))},getRowsHeight:function(a){var s=this.options,c=s.item_height;if(s.cluster_height=0,!!a.length){var u=this.content_elem.children;if(u.length){var f=u[Math.floor(u.length/2)];if(s.item_height=f.offsetHeight,s.tag=="tr"&&g("borderCollapse",this.content_elem)!="collapse"&&(s.item_height+=parseInt(g("borderSpacing",this.content_elem),10)||0),s.tag!="tr"){var h=parseInt(g("marginTop",f),10)||0,v=parseInt(g("marginBottom",f),10)||0;s.item_height+=Math.max(h,v)}return s.block_height=s.item_height*s.rows_in_block,s.rows_in_cluster=s.blocks_in_cluster*s.rows_in_block,s.cluster_height=s.blocks_in_cluster*s.block_height,c!=s.item_height}}},getClusterNum:function(a){var s=this.options;s.scroll_top=this.scroll_elem.scrollTop;var c=s.cluster_height-s.block_height,u=Math.floor(s.scroll_top/c),f=Math.floor(a.length*s.item_height/c);return Math.min(u,f)},generateEmptyRow:function(){var a=this.options;if(!a.tag||!a.show_no_data_row)return[];var s=document.createElement(a.tag),c=document.createTextNode(a.no_data_text),u;return s.className=a.no_data_class,a.tag=="tr"&&(u=document.createElement("td"),u.colSpan=100,u.appendChild(c)),s.appendChild(u||c),[s.outerHTML]},generate:function(a){var s=this.options,c=a.length;if(c<s.rows_in_block)return{top_offset:0,bottom_offset:0,rows_above:0,rows:c?a:this.generateEmptyRow()};var u=Math.max((s.rows_in_cluster-s.rows_in_block)*this.getClusterNum(a),0),f=u+s.rows_in_cluster,h=Math.max(u*s.item_height,0),v=Math.max((c-f)*s.item_height,0),y=[],m=u;h<1&&m++;for(var _=u;_<f;_++)a[_]&&y.push(a[_]);return{top_offset:h,bottom_offset:v,rows_above:m,rows:y}},renderExtraTag:function(a,s){var c=document.createElement(this.options.tag),u="clusterize-";return c.className=[u+"extra-row",u+a].join(" "),s&&(c.style.height=s+"px"),c.outerHTML},insertToDOM:function(a,s){this.options.cluster_height||this.exploreEnvironment(a,s);var c=this.generate(a),u=c.rows.join(""),f=this.checkChanges("data",u,s),h=this.checkChanges("top",c.top_offset,s),v=this.checkChanges("bottom",c.bottom_offset,s),y=this.options.callbacks,m=[];f||h?(c.top_offset&&(this.options.keep_parity&&m.push(this.renderExtraTag("keep-parity")),m.push(this.renderExtraTag("top-space",c.top_offset))),m.push(u),c.bottom_offset&&m.push(this.renderExtraTag("bottom-space",c.bottom_offset)),y.clusterWillChange&&y.clusterWillChange(),this.html(m.join("")),this.options.content_tag=="ol"&&this.content_elem.setAttribute("start",c.rows_above),this.content_elem.style["counter-increment"]="clusterize-counter "+(c.rows_above-1),y.clusterChanged&&y.clusterChanged()):v&&(this.content_elem.lastChild.style.height=c.bottom_offset+"px")},html:function(a){var s=this.content_elem;if(e&&e<=9&&this.options.tag=="tr"){var c=document.createElement("div"),u;for(c.innerHTML="<table><tbody>"+a+"</tbody></table>";u=s.lastChild;)s.removeChild(u);for(var f=this.getChildNodes(c.firstChild.firstChild);f.length;)s.appendChild(f.shift())}else s.innerHTML=a},getChildNodes:function(a){for(var s=a.children,c=[],u=0,f=s.length;u<f;u++)c.push(s[u]);return c},checkChanges:function(a,s,c){var u=s!=c[a];return c[a]=s,u}};function i(a,s,c){return s.addEventListener?s.addEventListener(a,c,!1):s.attachEvent("on"+a,c)}function l(a,s,c){return s.removeEventListener?s.removeEventListener(a,c,!1):s.detachEvent("on"+a,c)}function d(a){return Object.prototype.toString.call(a)==="[object Array]"}function g(a,s){return window.getComputedStyle?window.getComputedStyle(s)[a]:s.currentStyle[a]}return r})})(ke);var je=ke.exports;const ze=Re(je);class Ue{constructor(e){this.cfg=e,this.rowHeight=80,this.container=e.container,this.contentElem=e.container.appendChild(document.createElement("div")),this.debouncedOnProgressCallback=W(o=>{var r;(r=e==null?void 0:e.callbacks)==null||r.scrollingProgress(o)},200),this.cluster=new ze({rows:this._htmlRows(e.notes),scrollElem:e.container,contentElem:this.contentElem,callbacks:{scrollingProgress:o=>{this.debouncedOnProgressCallback(o)}}})}update(e){this.cfg.notes=e,this.cluster.update(this._htmlRows(e))}scrollTo(e){this.container&&(this.container.scrollTop=e*this.rowHeight)}_htmlRows(e){return e.map(o=>this.cfg.getCard(o).outerHTML)}}const We=()=>`
    <form class="note-form flex flex-col h-full">
      <input id="nf-title" placeholder="Note title" class="mb-3 text-2xl font-semibold outline-none w-full bg-transparent text-gray-900 dark:text-gray-100" >
      <textarea id="nf-body" rows="15" placeholder="Note content"
        class="flex-1 resize-none w-full outline-none border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 p-3 rounded mb-4">
      </textarea>
      <div class="flex items-center mb-4 space-x-3">
        <label class="text-sm">Color:</label>
        <input id="nf-color" type="color" value="#3b82f6" class="h-8 w-8 border-0" aria-label="Note color picker">
      </div>
      <div class="button-container">
        <button id="nf-submit" type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Save</button>
      </div>
    </form>`,Xe=()=>`
    <div class="flex h-full">
      <aside class="w-80 border-r border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 overflow-hidden">
        <div class="flex items-center justify-between p-4">
          <div class="flex items-center space-x-2">
            <img id="notePulseLogo" src="logo.svg" class="h-8 w-8" alt="NotePulse">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100">My Notes</h2>
          </div>
          <div class="flex items-center space-x-2">
            <button id="dark-toggle" class="p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700" aria-label="Toggle dark mode" aria-pressed="false">
              <svg class="w-4 h-4 text-gray-600 dark:text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                <path class="dark:hidden" d="M10 2L13.09 8.26L20 9L14 14.74L15.18 21.02L10 17.77L4.82 21.02L6 14.74L0 9L6.91 8.26L10 2Z"/>
                <path class="hidden dark:block" d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/>
              </svg>
            </button>
            <button id="sign-out" class="px-2 py-1 bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded text-sm hover:bg-gray-300 dark:hover:bg-gray-500">Sign out</button>
            <button id="new-note" class="p-2 bg-blue-600 text-white rounded-full hover:bg-blue-700" aria-label="Create note" disabled>+</button>
          </div>
        </div>
        <div class="px-4 pb-3 border-b border-gray-200 dark:border-gray-700">
          <div class="flex items-center space-x-2 mb-2">
            <input 
              type="search" 
              id="search-input" 
              placeholder="Search…" 
              class="flex-1 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded"
              autocomplete="off"
            >
            <div class="relative">
              <button id="sort-button" class="px-3 py-2 text-sm bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200 dark:hover:bg-gray-600 flex items-center space-x-1" aria-haspopup="menu" aria-expanded="false" aria-label="Sort by Created (descending)">
                <span id="sort-label">Created</span>
                <svg id="sort-order" class="w-4 h-4 inline" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20" style="pointer-events: none;">
                  <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
                </svg>
              </button>
              <div id="sort-dropdown" class="absolute top-full right-0 mt-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded shadow-lg z-10 hidden min-w-max" role="menu" aria-labelledby="sort-button">
                <button class="w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700" role="menuitemradio" aria-checked="true" data-sort="created_at">Created</button>
                <button class="w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700" role="menuitemradio" aria-checked="false" data-sort="updated_at">Updated</button>
                <button class="w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700" role="menuitemradio" aria-checked="false" data-sort="title">Title</button>
              </div>
            </div>
          </div>
          <div id="notes-count" class="text-sm text-gray-500 dark:text-gray-400" aria-live="polite" aria-atomic="true"></div>
        </div>
        <div id="note-list" class="note-list overflow-y-auto h-[calc(100%-120px)] p-2 space-y-2" role="listbox" aria-label="Notes" tabindex="0"></div>
      </aside>
      <main class="flex-1 p-6 overflow-y-auto">
        <div id="editor" class="h-full flex flex-col"></div>
      </main>
    </div>`,Je=()=>`<div class="flex cursor-pointer bg-white dark:bg-gray-800 rounded-lg shadow hover:bg-gray-50 dark:hover:bg-gray-700">
            <div class="w-2 rounded-l-lg note-color-bar rounded-lg"></div>
            <div class="flex-1 p-3 min-w-0">
              <h3 class="font-medium truncate note-title dark:text-gray-100"></h3>
              <p class="text-sm text-gray-500 dark:text-gray-400 line-clamp-2 note-body"></p>
              <span class="text-xs text-gray-400 dark:text-gray-500 note-updated"></span>
            </div>
          </div>`,Ve=()=>`<div class="text-center text-gray-400 dark:text-gray-500 italic m-auto">
            <h2 class="text-xl mb-4">Pick a note from the list</h2>
            <p>Nothing to edit. Select a note or create one.</p>
          </div>`,Ye=(t,e)=>`
      <div class="flex items-center justify-center h-full">
        <form id="${e}" class="max-w-sm w-full bg-white dark:bg-gray-800 p-6 rounded-xl shadow">
          <h2 class="text-2xl font-semibold mb-4 text-center text-gray-900 dark:text-gray-100">${t?"Sign in":"Sign up"}</h2>
          <input type="email"    id="email"    placeholder="Email"
                 class="w-full mb-3 px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded"
                 autocomplete="email" required>
          <input type="password" id="password" placeholder="Password"
                 class="w-full mb-4 px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded"
                 autocomplete="${t?"current-password":"new-password"}"
                 required minlength="6">
          <button class="w-full py-2 text-white rounded ${t?"bg-blue-600 hover:bg-blue-700":"bg-green-600 hover:bg-green-700"}">${t?"Sign in":"Create account"}</button>
          <p class="text-sm text-center mt-4 text-gray-600 dark:text-gray-400">${t?"No account?":"Have an account?"}
            <a href="${t?"#/sign-up":"#/sign-in"}" class="text-blue-600 underline">${t?"Sign up":"Sign in"}</a>
          </p>
        </form>
      </div>`,xe=t=>{const e=document.createElement("div");return e.innerHTML=t,e},Ne=t=>{Se();const e=t==="in",o=e?"sign-in-form":"sign-up-form";b("#root").innerHTML=Ye(e,o),k(b(`#${o}`),"submit",async r=>{r.preventDefault();const i=r.target.email.value,l=r.target.password.value;try{const d=e?await L.signIn(i,l):await L.signUp(i,l);p({accessToken:d.token,refreshToken:d.refresh_token}),location.hash="#/app",z()}catch{N(e?"Invalid credentials or sign-in failed":"Error creating account")}})},Ge=()=>Ne("in"),Ke=()=>Ne("up"),Ee=({mode:t="edit",note:e={title:"",body:"",color:"#3b82f6"},onSubmit:o,onDelete:r,onCancel:i})=>{const l=document.createElement("div");l.innerHTML=We();const d=l.querySelector(".note-form");d.setAttribute("data-mode",t);const g=d.querySelector("#nf-title"),a=d.querySelector("#nf-body"),s=d.querySelector("#nf-color");g.value=e.title||"",a.value=e.body||"",s.value=e.color&&Z(e.color)?Q(e.color):"#3b82f6";const c=d.querySelector("#nf-submit"),u=d.querySelector(".button-container");c.textContent=t==="create"?"Create":"Save";let f=null;t==="edit"&&(f=document.createElement("button"),f.type="button",f.className="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",f.setAttribute("aria-label","Delete note"),f.textContent="Delete",u.appendChild(f));let h=null;return t==="create"&&i&&(h=document.createElement("button"),h.type="button",h.className="px-4 py-2 bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-300 dark:hover:bg-gray-500",h.textContent="Cancel",u.appendChild(h)),k(d,"submit",v=>{v.preventDefault();const y=s.value;if(!s.checkValidity()||y&&!Z(y)){N("Invalid color");return}o==null||o({...e,title:g.value,body:a.value,color:y&&Q(y)})}),f&&k(f,"click",()=>r==null?void 0:r(e)),h&&k(h,"click",()=>i==null?void 0:i()),d},Ze=()=>{let t=!1;try{t=localStorage.getItem("notePulseDarkMode")==="true"}catch(o){console.warn("Failed to read dark mode preference:",o)}t=!t;try{localStorage.setItem("notePulseDarkMode",t.toString())}catch(o){console.warn("Failed to save dark mode preference:",o)}t?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark");const e=b("#dark-toggle");e&&e.setAttribute("aria-pressed",t.toString()),N(t?"🌙 Dark mode on":"☀️ Light mode on","success")},Qe=()=>{let t=!1;try{t=localStorage.getItem("notePulseDarkMode")==="true"}catch(o){console.warn("Failed to read dark mode preference:",o)}const e=b("#dark-toggle");e&&e.setAttribute("aria-pressed",t.toString())},V=async()=>{p({isLoading:!0}),x();try{await Ce()}catch(t){t.message.includes("400")?N("Invalid filter settings","error"):t.message.includes("401")||t.message.includes("403")||N("Error loading notes","error")}},et=()=>{const t=b("#search-input"),e=b("#sort-button"),o=b("#sort-dropdown"),r=b("#sort-label"),i=b("#sort-order"),l=b("#notes-count");if(!t||!e||!o)return;const d=W(u=>{const f=u.target.value.trim();f!==n.q&&(p({q:f}),J(),V())},300);k(t,"input",d),k(t,"keydown",u=>{u.key==="Escape"&&(u.target.value="",u.target.focus(),n.q!==""&&(p({q:""}),J(),V()))}),k(e,"click",u=>{u.stopPropagation();const f=o.classList.contains("hidden");o.classList.toggle("hidden"),e.setAttribute("aria-expanded",f?"true":"false")}),k(document,"click",()=>{o.classList.contains("hidden")||(o.classList.add("hidden"),e.setAttribute("aria-expanded","false"))}),o.querySelectorAll("[data-sort]").forEach(u=>{k(u,"click",f=>{const h=f.target.dataset.sort,v=n.sort,y=n.order;let m="desc";h===v&&(m=y==="desc"?"asc":"desc"),p({sort:h,order:m}),a(),J(),V();const _=b("#note-list");_&&(_.scrollTop=0),o.classList.add("hidden")})});const a=()=>{const u={created_at:"Created",updated_at:"Updated",title:"Title"};if(r&&(r.textContent=u[n.sort]||"Created"),e){const h=u[n.sort]||"Created",v=n.order==="asc"?"ascending":"descending";e.setAttribute("aria-label",`Sort by ${h} (${v})`)}const f=o==null?void 0:o.querySelectorAll("[data-sort]");f&&f.forEach(h=>{const v=h.dataset.sort===n.sort;h.setAttribute("aria-checked",v.toString())}),i&&(n.order==="asc"?i.innerHTML='<path d="M5 15l7-7 7 7"/>':i.innerHTML='<path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>')},s=()=>{if(l)if(n.totalCount!==null){const u=n.noteOrder.length,f=n.totalCount;l.textContent=`${u} of ${f} notes`}else l.textContent="0 of 0 notes"},c=me(()=>{s()});ne(c),a(),s()},B=[[60,"s"],[60,"m"],[24,"h"],[30,"d"],[12,"mo"]],tt=t=>{const e=Date.now(),o=Math.floor((e-new Date(t).getTime())/1e3);if(o<5)return"just now";let r=o,i=0;for(;i<B.length&&r>=B[i][0];)r=Math.floor(r/B[i][0]),i++;return r+B[Math.min(i,B.length-1)][1]+" ago"};let ee;const ot=()=>{ee=new $e({duration:3e3,position:{x:"center",y:"top"}})},N=(t,e="error")=>e==="error"?ee.error(t):ee.success(t);let te=[];const ne=t=>{te.push(t)};let w=null,F=80;const Ce=async t=>{try{const e=t?{anchor:t,span:40,sort:n.sort,order:n.order,q:n.q}:{limit:50,sort:n.sort,order:n.order,q:n.q},o=await L.listNotes(e);if(se(o,"replace"),w.update(n.noteOrder),F===80){const r=b("#note-list [data-note-id]");r?F=r.offsetHeight+8:requestAnimationFrame(()=>{const i=b("#note-list [data-note-id]");i&&(F=i.getBoundingClientRect().height+8)})}t&&typeof o.anchor_index=="number"&&w.scrollTo(o.anchor_index-1)}finally{p({isLoading:!1}),x()}},rt=W(async()=>{if(!n.isLoading){p({isLoading:!0});try{const t=b("#note-list").scrollTop,e=await L.listNotes({cursor:n.prevCursor,limit:50,sort:n.sort,order:n.order,q:n.q}),o=se(e,"prepend");w.update(n.noteOrder),ie(),b("#note-list").scrollTop=t+o*F}finally{p({isLoading:!1})}}},250),nt=W(async()=>{if(!n.isLoading){p({isLoading:!0});try{const t=await L.listNotes({cursor:n.nextCursor,limit:50,sort:n.sort,order:n.order,q:n.q});se(t,"append"),w.update(n.noteOrder),ie()}finally{p({isLoading:!1})}}},250),se=(t,e)=>{const o=t.notes||[];return o.forEach(r=>{n.notesById.has(r.id)||n.notesById.set(r.id,r)}),e==="replace"?n.noteOrder=o.map(r=>r.id):e==="prepend"?n.noteOrder=[...o.map(r=>r.id),...n.noteOrder]:n.noteOrder.push(...o.map(r=>r.id)),p({noteOrder:n.noteOrder,notesById:n.notesById,prevCursor:t.prev_cursor||null,nextCursor:t.has_more?t.next_cursor:null,totalCount:t.total_count??n.totalCount}),ie(),o.length},ie=()=>{if(!w)return;const t=Math.max(0,(n.totalCount??0)-n.noteOrder.length);w.contentElem.style.paddingBottom=`${t*F}px`};function st(t){if(!n.isLoading){if(t<10&&n.prevCursor){rt();return}t>90&&n.nextCursor&&nt()}}const k=(t,e,o)=>{t.addEventListener(e,o);const r=()=>t.removeEventListener(e,o);return ne(r),r},Te=()=>{w!=null&&w.cluster&&(w.cluster.destroy(!0),w=null)},Se=()=>{Te(),te.forEach(t=>t()),te=[]},pe=xe(Je()),ge=xe(Ve()),it=(t,e=!1)=>{if(!pe)return null;const o=pe.cloneNode(!0).firstElementChild;e&&o.classList.add("selected");const r=t.color&&Z(t.color)?Q(t.color):"#3b82f6";return o.querySelector(".note-color-bar").style.background=r,o.querySelector(".note-title").textContent=t.title,o.querySelector(".note-body").textContent=t.body,o.querySelector(".note-updated").textContent=tt(t.updated_at),o.dataset.noteId=t.id,o.setAttribute("role","option"),o.setAttribute("aria-label",t.title),o.setAttribute("aria-selected",e.toString()),o.setAttribute("tabindex","0"),o.querySelector(".note-title").id=`nt-${t.id}`,o},at=()=>ge?ge.cloneNode(!0).firstElementChild:null,lt=()=>{addEventListener("hashchange",z),z()},z=()=>{const t=location.hash||(n.accessToken?"#/app":"#/sign-in");if(!n.accessToken&&t.startsWith("#/app")){location.hash="#/sign-in";return}if(n.accessToken&&t.startsWith("#/sign-")){location.hash="#/app";return}if(t==="#/sign-in")Ge();else if(t==="#/sign-up")Ke();else if(t.startsWith("#/app")){const e=t.split("/"),o=e.length>2?e[2]:null;dt(o)}else location.hash=n.accessToken?"#/app":"#/sign-in"},ct=t=>{const{type:e,note:o}=JSON.parse(t.data);switch(e){case"created":{for(let i=0;i<n.noteOrder.length;i++){const l=n.noteOrder[i];if(l.startsWith("tmp-")){const d=n.notesById.get(l);if(d&&d.title===o.title&&d.body===o.body){n.noteOrder.splice(i,1),n.notesById.delete(l);break}}}const r=!n.notesById.has(o.id);$(o),x(),r&&(N("Note created","success"),H(o));break}case"updated":{n.notesById.has(o.id)&&($(o),x(),n.currentNoteId===o.id&&H(o));break}case"deleted":{ye(o.id),x(),n.currentNoteId===o.id&&ae(),N("Note deleted","error");break}}},dt=(t=null)=>{Te(),Se(),_e(),b("#root").innerHTML=Xe(),k(b("#new-note"),"click",ut),k(b("#dark-toggle"),"click",Ze),Qe(),et(),k(b("#sign-out"),"click",async()=>{try{await L.signOut()}catch{console.error("Sign-out API call failed")}U(),location.hash="#/sign-in",z(),N("Signed out","success")});const e=me(r=>{const i=b("#new-note");i&&(r.ws&&r.ws.readyState===WebSocket.OPEN?i.removeAttribute("disabled"):i.setAttribute("disabled",""))});ne(e),Le(),ae();const o=sessionStorage.getItem("notePulseLastNote");p({isLoading:!0}),x(),Ce(t||o).then(()=>q(ct)).catch(r=>{N(r.message),x()})},x=()=>{const t=b("#note-list");w?w.update(n.noteOrder):(w=new Ue({container:t,notes:n.noteOrder,getCard:e=>{const o=n.notesById.get(e);return o?it(o,n.currentNoteId===e):document.createElement("div")},callbacks:{scrollingProgress:st}}),k(t,"click",e=>{const o=e.target.closest("[data-note-id]");if(o){const r=n.notesById.get(o.dataset.noteId);r&&H(r)}}),k(t,"keydown",e=>{if(e.key==="Enter"||e.key===" "){const o=e.target.closest("[data-note-id]");if(o){e.preventDefault();const r=n.notesById.get(o.dataset.noteId);r&&H(r)}}}))},ae=()=>{const t=b("#editor");t.textContent="";const e=at();e&&t.appendChild(e);try{sessionStorage.removeItem("notePulseLastNote")}catch(o){console.warn("Failed to remove notePulseLastNote from storage:",o)}document.title="NotePulse",p({currentNoteId:null})},H=t=>{p({currentNoteId:t.id});try{sessionStorage.setItem("notePulseLastNote",t.id)}catch(d){console.warn("Failed to set notePulseLastNote in storage:",d)}location.hash.startsWith("#/app")||(location.hash="#/app"),history.replaceState(null,"",`#/app/${t.id}`);const e=t.title?t.title.replace(/[<>&"']/g,""):"Untitled";document.title=`${e} - NotePulse`;const o=b("#note-list").querySelectorAll("[data-note-id]");for(const d of o)d.dataset.noteId===t.id?(d.classList.add("selected"),d.setAttribute("aria-selected","true")):(d.classList.remove("selected"),d.setAttribute("aria-selected","false"));const r=b("#note-list");r&&r.setAttribute("aria-activedescendant",`nt-${t.id}`);const i=b("#editor");i.textContent="",(()=>{i.textContent="";const d=Ee({mode:"edit",note:t,onSubmit:async g=>{const a=d.querySelector("#nf-submit"),s={...t};a.disabled=!0,Object.assign(t,g,{updated_at:new Date().toISOString()}),$(t),x();try{const c=await L.updateNote(t.id,g);$(c.note),x();const u=d.querySelector("#nf-title"),f=d.querySelector("#nf-body"),h=d.querySelector("#nf-color");(c.note.title!==u.value||c.note.body!==f.value||c.note.color!==h.value)&&H(c.note),N("Saved","success")}catch{Object.assign(t,s),$(t),x(),H(t),N("Error saving note")}finally{a.disabled=!1}},onDelete:async()=>{ye(t.id),x(),ae();try{await L.deleteNote(t.id)}catch{N("Error deleting note")}}});if(d){i.appendChild(d);const g=d.querySelector("#nf-title");g&&requestAnimationFrame(()=>g.focus())}})()},ut=()=>{const t=document.activeElement,e=Fe("div","modal-overlay");e.setAttribute("role","dialog"),e.setAttribute("aria-modal","true"),e.setAttribute("aria-labelledby","modal-title");const o=document.createElement("div");o.className="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 w-96";const r=document.createElement("h3");r.id="modal-title",r.className="text-lg font-semibold mb-4 text-gray-900 dark:text-gray-100",r.textContent="New note",o.appendChild(r);const i=()=>{e.remove(),document.removeEventListener("keydown",s),t==null||t.focus()},l=Ee({mode:"create",note:{title:"",body:"",color:"#3b82f6"},onSubmit:async c=>{i();const u="tmp-"+Date.now(),f={...c,id:u,updated_at:new Date().toISOString()};n.noteOrder.unshift(u),n.notesById.set(u,f),x();try{await L.createNote(c);const h=n.noteOrder.indexOf(u);h>-1&&(n.noteOrder.splice(h,1),n.notesById.delete(u)),x()}catch{const h=n.noteOrder.indexOf(u);h>-1&&(n.noteOrder.splice(h,1),n.notesById.delete(u)),x(),N("Failed to create note")}},onCancel:i});l&&o.appendChild(l),e.appendChild(o),document.body.appendChild(e);const d=e.querySelectorAll("input, textarea, button"),g=d[0],a=d[d.length-1],s=c=>{c.key==="Escape"?i():c.key==="Tab"&&(c.shiftKey?document.activeElement===g&&(c.preventDefault(),a.focus()):document.activeElement===a&&(c.preventDefault(),g.focus()))};document.addEventListener("keydown",s),g==null||g.focus()},ft=()=>{try{localStorage.getItem("notePulseDarkMode")==="true"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}catch(t){console.warn("Failed to read dark mode preference:",t)}};(async()=>(ft(),ot(),Me(),await oe().catch(()=>{}),sessionStorage.getItem("notePulseAccess")&&L.me().catch(()=>U()),lt()))();
